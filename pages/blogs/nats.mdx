## ä»€ä¹ˆæ˜¯äº‘åŸç”Ÿæ¶ˆæ¯ç³»ç»Ÿï¼Ÿ
äº‘åŸç”Ÿæ¶ˆæ¯ç³»ç»Ÿæ˜¯ä¸€ç§ä¸ºäº‘è®¡ç®—ç¯å¢ƒä¼˜åŒ–çš„æ¶ˆæ¯ä¼ é€’è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¾®æœåŠ¡æ¶æ„å’Œå®¹å™¨åŒ–éƒ¨ç½²ï¼Œæä¾›é«˜å¯æ‰©å±•æ€§ã€å¼¹æ€§å’Œå¯é æ€§ã€‚

## å¾®æœåŠ¡æ¶æ„çš„è´Ÿæ‹…
å¾®æœåŠ¡æ¶æ„è™½ç„¶å¸¦æ¥äº†æ¨¡å—åŒ–ã€å¯ä¼¸ç¼©æ€§å’Œé«˜å®¹é”™æ€§ç­‰ä¼˜ç‚¹ï¼Œä½†ä¹Ÿå¼•å…¥äº†ä¸€ç³»åˆ—æŒ‘æˆ˜å’Œé¢å¤–çš„å¤æ‚åº¦ã€‚ä»¥ä¸‹æ˜¯å¾®æœåŠ¡æ¶æ„çš„ä¸€äº›éœ€è¦å¤„ç†çš„æœºåˆ¶ï¼š

1. **æœåŠ¡æ³¨å†Œå’ŒæœåŠ¡å‘ç°**
   - æœåŠ¡å®ä¾‹éœ€è¦èƒ½å¤Ÿç›¸äº’å‘ç°å’Œé€šä¿¡ã€‚è¿™éœ€è¦ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¥è®°å½•æœåŠ¡çš„ä½ç½®ä¿¡æ¯ï¼Œä»¥ä¾¿å…¶ä»–æœåŠ¡èƒ½å¤Ÿæ‰¾åˆ°å¹¶è°ƒç”¨å®ƒä»¬ã€‚

2. **è´Ÿè½½å‡è¡¡**
   - åœ¨é«˜å¹¶å‘è¯·æ±‚ä¸‹ï¼Œå•ä¸ªæœåŠ¡å¯èƒ½æ— æ³•å¤„ç†å·¨å¤§çš„è´Ÿè½½ï¼Œéœ€è¦å°†è¯·æ±‚åˆ†æ•£åˆ°å¤šä¸ªå¤„ç†èŠ‚ç‚¹ä¸Šï¼Œä»¥æé«˜ç³»ç»Ÿçš„ååé‡ã€‚

3. **ç†”æ–­**
   - å½“ä¸€ä¸ªæœåŠ¡å¤±è´¥æ—¶ï¼Œå®ƒä¼šè¿…é€Ÿä¼ æ’­åˆ°å…¶ä»–æœåŠ¡ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ä¸‹é™ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªç†”æ–­æœºåˆ¶è®©æœåŠ¡è°ƒç”¨å¯ä»¥å¿«é€Ÿå¤±è´¥ï¼Œé¿å…æœåŠ¡å‡ºç°çº§è”é”™è¯¯ã€‚
   
4. **é™çº§**
   - å½“æœåŠ¡ä¸å¯ç”¨æˆ–å“åº”æ—¶é—´è¿‡é•¿æ—¶ï¼Œéœ€è¦æä¾›ä¸€ä¸ªå¤‡é€‰æ–¹æ¡ˆæ¥å¤„ç†è¯·æ±‚ï¼Œä»¥ä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚

5. **é‡è¯•**
   - åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡å¯èƒ½ä¼šå› ä¸ºå„ç§åŸå› ï¼ˆå¦‚ç½‘ç»œé—ªæ–­ã€åƒåœ¾å›æ”¶ã€çº¿ç¨‹æ­»é”ã€èµ„æºä¸è¶³ç­‰ï¼‰å‡ºç°ä¸å¯ç”¨çš„æƒ…å†µï¼Œéœ€è¦å¤„ç†æœåŠ¡è°ƒç”¨çš„é‡è¯•æœºåˆ¶ï¼Œä»¥æé«˜ç³»ç»Ÿçš„å®¹é”™ç‡ã€‚

6. **é…ç½®ç®¡ç†**
   - éœ€è¦ç®¡ç†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å„ä¸ªæœåŠ¡çš„é…ç½®ï¼Œç¡®ä¿é…ç½®çš„ä¸€è‡´æ€§å’ŒåŠ¨æ€æ›´æ–°ã€‚

7. **åˆ†å¸ƒå¼äº‹åŠ¡**
   - ä¸€ä¸ªå®Œæ•´çš„ä¸šåŠ¡æ“ä½œå¯èƒ½éœ€è¦è·¨å¤šä¸ªæœåŠ¡ã€è®¿é—®å¤šä¸ªæ•°æ®åº“æ¥å®Œæˆã€‚ä¸ºäº†ä¿è¯è¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä»¥ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ï¼Œéœ€è¦é›†æˆåˆ†å¸ƒå¼äº‹åŠ¡æœºåˆ¶ã€‚

8. **é“¾è·¯è¿½è¸ª**
   - ä¸€ä¸ªä¸šåŠ¡è¯·æ±‚å¯èƒ½æ¶‰åŠå¤šä¸ªæœåŠ¡ï¼Œéœ€è¦ä¸€ä¸ªèƒ½è¿½è¸ªè¯·æ±‚åœ¨å„ä¸ªæœåŠ¡é—´çš„æµåŠ¨çš„åˆ†ææœºåˆ¶ï¼Œä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½é”™è¯¯ä½ç½®å’Œæ€§èƒ½ç“¶é¢ˆã€‚

## ä»€ä¹ˆæ˜¯NATSï¼Ÿ
`NATS`æ˜¯ä¸€ä¸ªå¼€æºçš„ã€è½»é‡çº§ã€é«˜æ€§èƒ½çš„åˆ†å¸ƒå¼äº‘åŸç”Ÿæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼Œå®ƒåŸºäºå‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼Œé€‚ç”¨äºæ„å»ºåˆ†å¸ƒå¼å’Œå¾®æœåŠ¡åº”ç”¨ç¨‹åºã€‚NATSæä¾›äº†ä¸€ç§ç®€å•ã€å¯é ã€é«˜æ•ˆçš„æ–¹å¼æ¥ä¼ é€’ä¿¡æ¯ï¼Œå…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§å’Œå®¹é”™æ€§ã€‚

### NATSçš„æ ¸å¿ƒç‰¹æ€§
1. **é«˜æ€§èƒ½**ï¼šNATSèƒ½å¤Ÿè¾¾åˆ°æ¯ç§’æ•°ç™¾ä¸‡ä¸ªæ¶ˆæ¯çš„å¤„ç†èƒ½åŠ›ï¼Œå…·æœ‰ä½å»¶è¿Ÿå’Œé«˜ååé‡ã€‚
2. **è½»é‡çº§**ï¼šNATSæœåŠ¡å™¨ç¨‹åºå¾ˆå°ï¼Œåªæœ‰3Mï¼Œæ˜“äºéƒ¨ç½²å’Œç»´æŠ¤ã€‚
3. **å¯æ‰©å±•æ€§**ï¼šNATSæ”¯æŒé›†ç¾¤æ¨¡å¼ï¼Œå¯ä»¥è·¨å¤šä¸ªæœåŠ¡å™¨è¿›è¡Œæ‰©å±•ï¼Œæé«˜æ€§èƒ½å’Œå®¹é”™èƒ½åŠ›ã€‚
4. **å‘å¸ƒ/è®¢é˜…æ¨¡å¼**ï¼šNATSçš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªå‘å¸ƒ/è®¢é˜…æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼Œå…è®¸æ¶ˆæ¯ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯åˆ°ç‰¹å®šçš„ä¸»é¢˜ï¼Œè€Œæ¶ˆæ¯æ¶ˆè´¹è€…å¯ä»¥è®¢é˜…æ„Ÿå…´è¶£çš„ä¸»é¢˜æ¥æ¥æ”¶æ¶ˆæ¯ã€‚
5. **è¯·æ±‚/å“åº”æ¨¡å¼**ï¼šNATSæ”¯æŒè¯·æ±‚/å“åº”æ¨¡å¼ï¼Œå…è®¸å®¢æˆ·ç«¯å‘é€è¯·æ±‚æ¶ˆæ¯å¹¶ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ã€‚
6. **é›†ç¾¤æ¨¡å¼**ï¼šNATSæ”¯æŒé›†ç¾¤æ¨¡å¼ï¼Œå…è®¸è·¨å¤šä¸ªæœåŠ¡å™¨è¿›è¡Œæ‰©å±•ã€‚
7. **æŒä¹…åŒ–**ï¼šNATS Streamingæä¾›äº†æ¶ˆæ¯æŒä¹…åŒ–çš„åŠŸèƒ½ï¼Œç¡®ä¿å³ä½¿åœ¨æœåŠ¡å™¨é‡å¯åï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚
8. **å®‰å…¨æ€§**ï¼šNATSæ”¯æŒå¤šç§å®‰å…¨æœºåˆ¶ï¼ŒåŒ…æ‹¬TLSåŠ å¯†ã€ç”¨æˆ·è®¤è¯å’Œæˆæƒç­‰ã€‚

**NATS æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿé€šè¿‡å…¶è®¾è®¡å’Œç‰¹æ€§ï¼Œå¯ä»¥æœ‰æ•ˆåœ°è§£å†³å¾®æœåŠ¡æ¶æ„ä¸­çš„ä¸€äº›å…³é”®é—®é¢˜ï¼š**

1.  **æœåŠ¡å‘ç°**ï¼š

    - åœ¨NATSä¸­ï¼ŒæœåŠ¡é€šè¿‡å‘å¸ƒæ¶ˆæ¯åˆ°ä¸»é¢˜æˆ–è®¢é˜…ä¸»é¢˜æ¥äº¤æ¢ä¿¡æ¯ï¼Œè€Œä¸æ˜¯ç›´æ¥è°ƒç”¨å½¼æ­¤çš„æ¥å£ã€‚ 

2.  **è´Ÿè½½å‡è¡¡**ï¼š

    - NATSæ”¯æŒå‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼Œå…è®¸å¤šä¸ªè®¢é˜…è€…ä½¿ç”¨ç›¸åŒçš„é˜Ÿåˆ—åç§°è®¢é˜…åŒä¸€ä¸ªä¸»é¢˜ã€‚NATS ä¼šå°†æ¶ˆæ¯åˆ†å‘ç»™è¿™äº›è®¢é˜…è€…ä¸­çš„ä¸€ä¸ªï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚

3.  **ç†”æ–­**ï¼š

    - NATSå¯ä»¥é€šè¿‡åˆç†çš„è®¾è®¡æ¥å®ç°ç†”æ–­æœºåˆ¶ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è®¾ç½®æ¶ˆæ¯é‡è¯•æ¬¡æ•°å’Œè¶…æ—¶æ—¶é—´ï¼Œå½“è¾¾åˆ°ä¸€å®šæ¡ä»¶æ—¶ï¼Œåœæ­¢å‘é—®é¢˜æœåŠ¡å‘é€æ¶ˆæ¯ï¼Œä»è€Œé¿å…çº§è”æ•…éšœã€‚

4.  **é™çº§**ï¼š

    - NATSå¯ä»¥é€šè¿‡è®¾ç½®å¤‡é€‰çš„æ¶ˆæ¯å¤„ç†å™¨æ¥å®ç°é™çº§ç­–ç•¥ã€‚å¦‚æœä¸»æœåŠ¡ä¸å¯ç”¨ï¼ŒNATSå¯ä»¥å°†æ¶ˆæ¯è·¯ç”±åˆ°å¤‡ç”¨æœåŠ¡ï¼Œç¡®ä¿ç³»ç»Ÿç»§ç»­æä¾›æœåŠ¡ã€‚

5.  **é‡è¯•**ï¼š

    - NATSå¯ä»¥é…ç½®é‡è¯•æœºåˆ¶ï¼Œæ”¯æŒè¯·æ±‚/å“åº”æ¨¡å¼ï¼Œå¦‚æœæ¶ˆè´¹è€…æœªèƒ½å¤„ç†æ¶ˆæ¯ï¼Œæ¶ˆæ¯å¯ä»¥è¢«é‡æ–°å‘é€ã€‚

6.  **é…ç½®ç®¡ç†**ï¼š

    - NATSæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„é…ç½®å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡æ¥ç®¡ç†ã€‚å¯¹äºåŠ¨æ€é…ç½®æ›´æ–°ï¼Œå¯ä»¥ç»“åˆé…ç½®ç®¡ç†å·¥å…·ï¼ˆå¦‚Spring Cloud Configï¼‰å’ŒNATSå®ç°é…ç½®çš„åŠ¨æ€ä¸‹å‘ã€‚

7.  **åˆ†å¸ƒå¼äº‹åŠ¡**ï¼š

    - NATS JetStreamæä¾›äº†æ¶ˆæ¯æµçš„æŒä¹…åŒ–å’Œé«˜çº§æ¶ˆæ¯ä¼ é€’è¯­ä¹‰ï¼ŒåŒ…æ‹¬è‡³å°‘ä¸€æ¬¡ï¼ˆat-least-onceï¼‰å’Œæœ‰æ¡ä»¶çš„ç²¾ç¡®ä¸€æ¬¡ï¼ˆexactly-onceï¼‰äº¤ä»˜è¯­ä¹‰ã€‚è¿™ä½¿å¾— JetStream èƒ½å¤Ÿæ”¯æŒäº‹åŠ¡å‹æ¶ˆæ¯çš„å¤„ç†ï¼Œå¯ä»¥é€šè¿‡ä¸å…¶ä»–å·¥å…·ï¼ˆå¦‚æ•°æ®åº“äº‹åŠ¡ç®¡ç†å™¨ã€åˆ†å¸ƒå¼äº‹åŠ¡åè°ƒå™¨ç­‰ï¼‰ç»“åˆä½¿ç”¨æ¥å®ç°è·¨æœåŠ¡çš„äº‹åŠ¡ç®¡ç†ã€‚

8.  **é“¾è·¯è¿½è¸ª**ï¼š

    - NATSç›‘æ§ç³»ç»Ÿå¯ä»¥ç®€å•åœ°ä»¥å¦ä¸€ä¸ªNATSå®¢æˆ·ç«¯çš„å½¢å¼å®ç°ï¼Œè®¢é˜…ç‰¹å®šçš„ç›‘æ§ä¸»é¢˜ï¼Œæ¥æ”¶æœåŠ¡å™¨çŠ¶æ€æ›´æ–°ï¼ŒNATSä¹Ÿå¯ä»¥å’Œé“¾è·¯è¿½è¸ªå·¥å…·ï¼ˆå¦‚OpenTelemetryã€Jaegerç­‰ï¼‰é›†æˆï¼Œé€šè¿‡åœ¨æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­æ·»åŠ è¿½è¸ªä¿¡æ¯ï¼Œå®ç°è¯·æ±‚åœ¨å„ä¸ªæœåŠ¡é—´çš„æµåŠ¨è¿½è¸ªã€‚

## ä½¿ç”¨NATS

`NATS`æ˜¯ä¸è¯­è¨€æ— å…³çš„ï¼Œå®ƒæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€çš„å®¢æˆ·ç«¯åº“ï¼Œæ–¹ä¾¿å¼€å‘è€…é›†æˆã€‚ä»¥ä¸‹æ˜¯ NATS æ”¯æŒçš„ä¸€äº›è¯­è¨€ï¼š

1.  **Go**ï¼šNATSæ˜¯ç”¨ Go è¯­è¨€å®ç°çš„ï¼Œå…¶å®˜æ–¹ Go å®¢æˆ·ç«¯åº“çš„æ”¯æŒéå¸¸æˆç†ŸÂ ã€‚
2.  **Java**ï¼šå®˜æ–¹æä¾›äº† NATS çš„ Java å®¢æˆ·ç«¯Â ã€‚
3.  **Python**ï¼šå®˜æ–¹æœ‰ Python çš„æ”¯æŒåº“ï¼Œæ€§èƒ½è¾ƒå¥½Â ã€‚
4.  **C/C++** ï¼šNATS æä¾› C å’Œ C++ çš„åŸç”Ÿæ”¯æŒåº“Â ã€‚
5.  **Node.js**ï¼šå®˜æ–¹æ”¯æŒï¼Œé€‚åˆ Node.js ç¯å¢ƒä½¿ç”¨Â ã€‚
6.  **Rust**ã€**Ruby**ã€**C#** ã€**PHP**ã€**Elixir**Â ç­‰ï¼šNATS ä¹Ÿæ”¯æŒè¿™äº›è¯­è¨€ï¼Œæä¾›äº†å®˜æ–¹æˆ–ç¤¾åŒºç»´æŠ¤çš„å®¢æˆ·ç«¯åº“Â ã€‚

åœ¨TypeScriptä¸­ä½¿ç”¨`NATS`
```ts
import { NatsConnection, StringCodec, connect } from 'nats';

async function main() {
    try {
        // è¿æ¥åˆ°è¿è¡Œåœ¨localhostçš„NATSæœåŠ¡å™¨
        const nc: NatsConnection = await connect({ servers: ['nats://localhost:4222'] });

        console.log('Connected to NATS server');

        // åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²æ¶ˆæ¯ç¼–è§£ç å™¨
        const sc = StringCodec();

        // è®¢é˜…ä¸»é¢˜
        const sub = nc.subscribe("test");
        (async () => {
            for await (const m of sub) {
                console.log(`[${sub.getProcessed()}]: ${sc.decode(m.data)}`);
            }
            console.log("subscription closed");
        })();

        // å‘å¸ƒæ¶ˆæ¯åˆ°ä¸»é¢˜
        nc.publish('test', Buffer.from('Hello'));
        nc.publish('test', Buffer.from('World'));

        // ç­‰å¾…æ‰€æœ‰æ¶ˆæ¯è¢«æ’ç©ºåå…³é—­è¿æ¥
        await nc.drain();

    } catch (error) {
        console.error('Error connecting to NATS:', error);
    }
}
main();
```

`NestJS`æ¡†æ¶æ”¯æŒä½¿ç”¨`NATS`ä½œä¸ºå¾®æœåŠ¡çš„æ¶ˆæ¯ä¼ è¾“å™¨
```ts
const app = await NestFactory.createMicroservice<MicroserviceOptions>(AppModule, {
  transport: Transport.NATS,
  options: {
    servers: ['nats://localhost:4222'],
  },
});

@MessagePattern('notifications')
getNotifications(@Payload() data: number[], @Ctx() context: NatsContext) {
  console.log(`Subject: ${context.getSubject()}`);
}
```

**Headers**

`NATS`ä¸­çš„headersåŠŸèƒ½ç±»ä¼¼äºHTTP headersï¼Œå®ƒä»¬ä»¥é”®å€¼å¯¹çš„å½¢å¼æä¾›é¢å¤–çš„å…ƒæ•°æ®ã€‚Headersåœ¨`NATS`ä¸­æ‰®æ¼”äº†å¤šé‡è§’è‰²ï¼Œä»¥ä¸‹æ˜¯å®ƒä»¬çš„ä¸»è¦ä½œç”¨ï¼š

1.  **å»é‡ï¼ˆDe-duplicationï¼‰** ï¼š

    -   å®¢æˆ·ç«¯å¯ä»¥åœ¨å‘å¸ƒæ¶ˆæ¯æ—¶è®¾ç½®`Nats-Msg-Id`Â headerï¼ŒæœåŠ¡å™¨ä¼šä½¿ç”¨è¿™ä¸ªIDåœ¨é…ç½®çš„é‡å¤çª—å£å†…åº”ç”¨å»é‡é€»è¾‘ï¼Œç¡®ä¿æ¶ˆæ¯ä¸ä¼šè¢«é‡å¤å¤„ç†ã€‚

2.  **è‡ªåŠ¨æ¸…é™¤æ¶ˆæ¯ï¼ˆAuto-purging of messagesï¼‰** ï¼š

    -   é€šè¿‡è®¾ç½®`Nats-Rollup`Â headerï¼Œå¯ä»¥æ¸…é™¤æµä¸­æˆ–ä¸»é¢˜çº§åˆ«ä¸Šçš„æ‰€æœ‰å…ˆå‰æ¶ˆæ¯ã€‚

3.  **å…ƒæ•°æ®ä¼ é€’ï¼ˆMetadata from republished messagesï¼‰** ï¼š

    -   å½“æ¶ˆæ¯è¢«é‡æ–°å‘å¸ƒæ—¶ï¼ŒNATSä¼šè®¾ç½®ä¸€ç³»åˆ—headersï¼Œå¦‚`Nats-Stream`ã€`Nats-Subject`ã€`Nats-Sequence`ç­‰ï¼Œä»¥ä¿ç•™åŸå§‹æ¶ˆæ¯çš„å…ƒæ•°æ®ã€‚

4.  **ä¹è§‚å¹¶å‘æ§åˆ¶ï¼ˆOptimistic concurrency controlï¼‰** ï¼š

    -   é€šè¿‡`Nats-Expected-Last-Msg-Id`ã€`Nats-Expected-Last-Sequence`å’Œ`Nats-Expected-Last-Subject-Sequence`Â headersï¼Œå¯ä»¥å®ç°æµçº§åˆ«æˆ–ä¸»é¢˜çº§åˆ«çš„ä¹è§‚å¹¶å‘æ§åˆ¶ã€‚

5.  **æ¶ˆæ¯æ¥æºï¼ˆSourcesï¼‰** ï¼š

    -   å½“æ¶ˆæ¯ä»å…¶ä»–æµä¸­è¢«æºèµ·æ—¶ï¼Œ`Nats-Stream-Source`Â headerä¼šæŒ‡å®šåŸå§‹æµçš„åç§°ã€ä¸»é¢˜å’Œåºåˆ—å·ï¼Œä»¥åŠæ¶ˆæ¯çš„ä¸»é¢˜è¿‡æ»¤å™¨å’Œç›®çš„åœ°è½¬æ¢ã€‚

6.  **å†…éƒ¨æµæ§åˆ¶ï¼ˆInternal flow-control messages for a mirrorï¼‰** ï¼š

    -   åœ¨NATSçš„é•œåƒåŠŸèƒ½ä¸­ï¼Œheadersç”¨äºå†…éƒ¨æµæ§åˆ¶æ¶ˆæ¯ã€‚

7.  **æ¶ˆæ¯å¤§å°ï¼ˆMessage sizeï¼‰** ï¼š

    -   å½“æ¶ˆè´¹è€…é…ç½®ä¸ºä»…æ¥æ”¶headersæ—¶ï¼Œ`Nats-Msg-Size`Â headeræŒ‡ç¤ºæ¶ˆæ¯ä½“çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚

```ts
import * as nats from 'nats';

const headers = nats.headers();
headers.set('x-version', '1.0.0');

const record = new NatsRecordBuilder(':cat:').setHeaders(headers).build();
this.client.send('replace-emoji', record).subscribe(...);

@MessagePattern('replace-emoji')
replaceEmoji(@Payload() data: string, @Ctx() context: NatsContext): string {
  const headers = context.getHeaders();
  return headers['x-version'] === '1.0.0' ? 'ğŸ±' : 'ğŸˆ';
}
```

## æ€»ç»“
`NATS`ä½œä¸ºä¸€ä¸ªé«˜æ€§èƒ½ã€è½»é‡çº§ã€å¯æ‰©å±•çš„äº‘åŸç”Ÿæ¶ˆæ¯ç³»ç»Ÿï¼Œä¸ºå¾®æœåŠ¡æ¶æ„æä¾›äº†å¼ºå¤§çš„æ¶ˆæ¯ä¼ é€’èƒ½åŠ›ã€‚å®ƒé€šè¿‡æ”¯æŒæœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€ç†”æ–­ã€é™çº§ã€é‡è¯•ç­‰æœºåˆ¶ï¼Œæœ‰æ•ˆåœ°è§£å†³äº†å¾®æœåŠ¡æ¶æ„ä¸­çš„é€šä¿¡å’Œå¯é æ€§æŒ‘æˆ˜ã€‚`NATS`çš„è·¨è¯­è¨€æ”¯æŒå’ŒheadersåŠŸèƒ½è¿›ä¸€æ­¥å¢å¼ºäº†å…¶åœ¨æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„çµæ´»æ€§å’Œæ•ˆç‡ã€‚å› æ­¤ï¼Œ`NATS`æˆä¸ºäº†ç°ä»£äº‘åŸç”Ÿåº”ç”¨å¼€å‘ä¸­ä¸å¯æˆ–ç¼ºçš„æ¶ˆæ¯ä¼ é€’è§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºæ›´åŠ å¥å£®ã€å¯ç»´æŠ¤å’Œå¯æ‰©å±•çš„ç³»ç»Ÿã€‚